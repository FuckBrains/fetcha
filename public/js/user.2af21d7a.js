(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["user"],{"176d":function(t,e,r){"use strict";var a=r("91df"),s=r.n(a);s.a},"27c2":function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"user-form"},[r("div",{staticClass:"auth-sidebar",style:{background:t.workBackground}},[t.showWork?r("render-scene",{attrs:{scene:t.showWork.scenes[0],"view-box":t.showWork.viewBox,"view-port":t.showWork.viewport,stage:"enter"}}):t._e(),t.showWork?r("div",{staticClass:"by"},[t._v("Art by "+t._s(t.showWork.author))]):t._e()],1),r("section",{staticClass:"content"},[t._m(0),r("main",[r("div",{staticClass:"auth-content"},[r("h2",[t._v("注册")]),r("hr",{staticClass:"divider"}),r("div",{staticClass:"auth-form sign-in-form"},[r("form",{attrs:{"accept-charset":"UTF-8",method:"post",action:"/"},on:{submit:function(e){return e.preventDefault(),t.doRegister(e)}}},[r("input",{attrs:{name:"utf8",type:"hidden",value:"✓"}}),r("div",{staticClass:"form-fields"},[r("fieldset",[r("label",{attrs:{for:"username"}},[t._v("用户名 （手机号码）")]),r("input",{directives:[{name:"model",rawName:"v-model",value:t.username,expression:"username"}],staticClass:"text-input",class:t.error.username?"is-danger":"",attrs:{id:"username",type:"text",placeholder:"输入手机号码"},domProps:{value:t.username},on:{input:function(e){e.target.composing||(t.username=e.target.value)}}}),t.error.username?r("span",{staticClass:"error"},[t._v(t._s(t.error.username))]):t._e()]),r("fieldset",[r("label",{staticClass:"password"},[t._v("密码")]),r("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],staticClass:"text-input",class:t.error.password?"is-danger":"",attrs:{type:"password",placeholder:"输入密码"},domProps:{value:t.password},on:{input:function(e){e.target.composing||(t.password=e.target.value)}}}),t.error.password?r("span",{staticClass:"error"},[t._v("密码不能为空")]):t._e()]),r("fieldset",[r("label",[t._v("验证码"),r("span",{domProps:{innerHTML:t._s(t.svg)},on:{click:t.refreshCaptcha}})]),r("input",{directives:[{name:"model",rawName:"v-model",value:t.captcha,expression:"captcha"}],staticClass:"text-input small",class:t.error.captcha?"is-danger":"",attrs:{type:"text"},domProps:{value:t.captcha},on:{input:function(e){e.target.composing||(t.captcha=e.target.value)}}}),t.error.captcha?r("span",{staticClass:"error"},[t._v(t._s(t.error.captcha))]):t._e()]),r("fieldset",[r("input",{directives:[{name:"model",rawName:"v-model",value:t.checked,expression:"checked"}],attrs:{type:"checkbox"},domProps:{checked:Array.isArray(t.checked)?t._i(t.checked,null)>-1:t.checked},on:{change:function(e){var r=t.checked,a=e.target,s=!!a.checked;if(Array.isArray(r)){var o=null,i=t._i(r,o);a.checked?i<0&&(t.checked=r.concat([o])):i>-1&&(t.checked=r.slice(0,i).concat(r.slice(i+1)))}else t.checked=s}}}),t._m(1)]),r("fieldset",[r("input",{staticClass:"button form-sub",attrs:{disabled:!t.checked,type:"submit",value:"创建新的账号",tabindex:"3"}})])])])])])])])])},s=[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("nav",{staticClass:"auth-nav"},[r("p",{staticClass:"auth-link"},[t._v(" 已有账号? "),r("a",{attrs:{href:"/login"}},[t._v("去登录")])])])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("span",[t._v("同意"),r("a",{attrs:{href:"#"}},[t._v("使用条款")])])}],o=r("b812"),i=r("8b3e"),n={name:"Register",components:{RenderScene:i["a"]},mixins:[o["a"]],data(){return{username:"",checked:!0,error:{username:"",password:"",captcha:""},svg:"",captcha:"",password:"",workViewPort:{width:200,height:200}}},computed:{workBackground(){return this.showWork?this.showWork.color:""},showWork(){return this.works.length?this.works[0]:null}},created(){},mounted(){this.refreshCaptcha(),this.initViewPort(),this.loadWorks()},methods:{initViewPort(){const t=document.querySelector(".auth-sidebar").getBoundingClientRect();this.workViewPort={width:t.width,height:t.height}},viewport(){return this.workViewPort},listQuery(){return{count:1,"system.site":"on"}},async refreshCaptcha(){const t=await this.ctx.userdao.getCaptcha();this.svg=t.svg},async doRegister(){if(this.error.username="",this.error.password="",this.error.captcha="",""===this.username)return void(this.error.username="请输入用户名");if(""===this.password)return void(this.error.password="请输入密码");if(""===this.captcha)return void(this.error.captcha="请输入验证码");const t=await this.ctx.userdao.register(this.username,this.password,this.nickname,this.captcha);400!==t.code?403!==t.code?409!==t.code?(t.token&&localStorage.setItem("token",t.token),this.$router.replace("/")):this.error.username="手机号码已经注册过":this.error.captcha="输入的验证码不正确":this.error.username="手机号码格式不正确"}}},c=n,u=(r("ffae"),r("2877")),l=Object(u["a"])(c,a,s,!1,null,null,null);e["default"]=l.exports},"2bb5":function(t,e,r){"use strict";e.__esModule=!0;r("8122");e.default={mounted:function(){},methods:{getMigratingConfig:function(){return{props:{},events:{}}}}}},"3ba4":function(t,e,r){},"3bba":function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"user-profile"}},[r("form",{on:{submit:function(e){return e.preventDefault(),t.updateUserProfile(e)}}},[r("fieldset",[r("label",[t._v("用户账号")]),r("span",[t._v(t._s(t.user.id))])]),r("fieldset",[r("label",[t._v("用户名")]),r("span",[r("input",{directives:[{name:"model",rawName:"v-model",value:t.user.nick,expression:"user.nick"}],attrs:{type:"text"},domProps:{value:t.user.nick},on:{input:function(e){e.target.composing||t.$set(t.user,"nick",e.target.value)}}})])]),r("fieldset",[r("label",[t._v("位置")]),r("span",[r("input",{directives:[{name:"model",rawName:"v-model",value:t.user.location,expression:"user.location"}],attrs:{type:"text"},domProps:{value:t.user.location},on:{input:function(e){e.target.composing||t.$set(t.user,"location",e.target.value)}}})])]),r("fieldset",[r("label",[t._v("电子邮件")]),r("span",[r("input",{directives:[{name:"model",rawName:"v-model",value:t.user.email,expression:"user.email"}],attrs:{type:"text"},domProps:{value:t.user.email},on:{input:function(e){e.target.composing||t.$set(t.user,"email",e.target.value)}}})])]),r("fieldset",[r("button",{attrs:{type:"submit"}},[t._v("保存")]),r("button",{staticClass:"danger",attrs:{type:"button"},on:{click:t.logout}},[t._v("退出登录")])])])])},s=[],o=(r("0fb7"),r("450d"),r("f529")),i=r.n(o),n=(r("f225"),r("89a9")),c=r.n(n),u=r("d05f"),l=r("47c2"),h={name:"UserHome",components:{[c.a.name]:c.a},data(){return{user:this.ctx.user}},computed:{avatar(){return this.user&&this.user.avatar?this.getImageUrl(this.user.avatar,96,96):"http://cdn.danke.fun/res/head.svg"}},created(){this.imagedao=new u["a"](this.ctx)},methods:{getImageUrl:l["a"],async avatarChosen(t,e){const r=await this.imagedao.uploadBlob(t.raw,"profile");await this.ctx.userdao.setAvatar(r.name);const a=await this.ctx.userdao.getCurrentUser();this.ctx.user=a,this.user=a},async logout(){await this.ctx.userdao.logout(),this.ctx.user={},this.$router.replace("/")},async updateUserProfile(){await this.ctx.userdao.setUserProfile({email:this.user.email,nick:this.user.nick,location:this.user.location});const t=await this.ctx.userdao.getCurrentUser();this.ctx.user=t,this.user=t,i.a.success({message:"用户状态更新成功"})}}},d=h,p=(r("521a"),r("2877")),m=Object(p["a"])(d,a,s,!1,null,null,null);e["default"]=m.exports},"3c4e":function(t,e,r){"use strict";var a=function(t){return s(t)&&!o(t)};function s(t){return!!t&&"object"===typeof t}function o(t){var e=Object.prototype.toString.call(t);return"[object RegExp]"===e||"[object Date]"===e||c(t)}var i="function"===typeof Symbol&&Symbol.for,n=i?Symbol.for("react.element"):60103;function c(t){return t.$$typeof===n}function u(t){return Array.isArray(t)?[]:{}}function l(t,e){var r=e&&!0===e.clone;return r&&a(t)?p(u(t),t,e):t}function h(t,e,r){var s=t.slice();return e.forEach((function(e,o){"undefined"===typeof s[o]?s[o]=l(e,r):a(e)?s[o]=p(t[o],e,r):-1===t.indexOf(e)&&s.push(l(e,r))})),s}function d(t,e,r){var s={};return a(t)&&Object.keys(t).forEach((function(e){s[e]=l(t[e],r)})),Object.keys(e).forEach((function(o){a(e[o])&&t[o]?s[o]=p(t[o],e[o],r):s[o]=l(e[o],r)})),s}function p(t,e,r){var a=Array.isArray(e),s=Array.isArray(t),o=r||{arrayMerge:h},i=a===s;if(i){if(a){var n=o.arrayMerge||h;return n(t,e,r)}return d(t,e,r)}return l(e,r)}p.all=function(t,e){if(!Array.isArray(t)||t.length<2)throw new Error("first argument should be an array with at least two elements");return t.reduce((function(t,r){return p(t,r,e)}))};var m=p;t.exports=m},4897:function(t,e,r){"use strict";e.__esModule=!0,e.i18n=e.use=e.t=void 0;var a=r("f0d9"),s=h(a),o=r("2b0e"),i=h(o),n=r("3c4e"),c=h(n),u=r("9d7e"),l=h(u);function h(t){return t&&t.__esModule?t:{default:t}}var d=(0,l.default)(i.default),p=s.default,m=!1,f=function(){var t=Object.getPrototypeOf(this||i.default).$t;if("function"===typeof t&&i.default.locale)return m||(m=!0,i.default.locale(i.default.config.lang,(0,c.default)(p,i.default.locale(i.default.config.lang)||{},{clone:!0}))),t.apply(this,arguments)},v=e.t=function(t,e){var r=f.apply(this,arguments);if(null!==r&&void 0!==r)return r;for(var a=t.split("."),s=p,o=0,i=a.length;o<i;o++){var n=a[o];if(r=s[n],o===i-1)return d(r,e);if(!r)return"";s=r}return""},g=e.use=function(t){p=t||p},w=e.i18n=function(t){f=t||f};e.default={use:g,t:v,i18n:w}},"521a":function(t,e,r){"use strict";var a=r("d84e"),s=r.n(a);s.a},"6b7c":function(t,e,r){"use strict";e.__esModule=!0;var a=r("4897");e.default={methods:{t:function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return a.t.apply(this,e)}}}},"91df":function(t,e,r){},"9d7e":function(t,e,r){"use strict";e.__esModule=!0;var a="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.default=function(t){function e(t){for(var e=arguments.length,r=Array(e>1?e-1:0),i=1;i<e;i++)r[i-1]=arguments[i];return 1===r.length&&"object"===a(r[0])&&(r=r[0]),r&&r.hasOwnProperty||(r={}),t.replace(o,(function(e,a,o,i){var n=void 0;return"{"===t[i-1]&&"}"===t[i+e.length]?o:(n=(0,s.hasOwn)(r,o)?r[o]:null,null===n||void 0===n?"":n)}))}return e};var s=r("8122"),o=/(%|)\{([0-9a-zA-Z_]+)\}/g},b812:function(t,e,r){"use strict";var a=r("b5f7"),s=r("7532");r("2c7e");e["a"]={data(){return{loading:!0,page:1,count:24,total:0,works:[]}},created(){this.workdao=new a["a"](this.ctx,"danke/work"),this.svgdao=new a["a"](this.ctx,"danke/svg"),this.ctx.styleRegistry=new s["a"]},methods:{listQuery(){return{creator:this.ctx.user.id}},viewport(){return{width:200,height:200}},horizontalViewPort(t){return{height:200,width:200/t.viewBox.height*t.viewBox.width}},horizontalViewPortStyle(t){return{height:"200px",width:200/t.viewBox.height*t.viewBox.width+"px"}},verticalViewPort(t){return{height:360,width:360/t.viewBox.height*t.viewBox.width}},verticalViewPortStyle(t){return{height:"360px",width:360/t.viewBox.height*t.viewBox.width+"px"}},async loadWorks(){const t=await this.workdao.list(Object.assign({projection:"updated,created,creator,name,id,frames,viewBox,title,author,avatar,color,snapshot",page:this.page,count:this.count},this.listQuery()));this.works=t.list,this.total=t.total,this.loading=!1}}}},d0f4:function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"user-form"},[r("div",{staticClass:"auth-sidebar"}),r("section",{staticClass:"content"},[t._m(0),r("main",[r("div",{staticClass:"auth-content"},[r("h2",[t._v("登录")]),r("hr",{staticClass:"divider"}),r("div",{staticClass:"auth-form sign-in-form"},[r("form",{attrs:{"accept-charset":"UTF-8",method:"post",action:"/"},on:{submit:function(e){return e.preventDefault(),t.login(e)}}},[r("input",{attrs:{name:"utf8",type:"hidden",value:"✓"}}),r("div",{staticClass:"form-fields"},[r("fieldset",[r("label",{attrs:{for:"login"}},[t._v("用户名 （手机号码）")]),r("input",{directives:[{name:"model",rawName:"v-model",value:t.username,expression:"username"}],staticClass:"text-input",attrs:{id:"login",type:"text",name:"login",autocorrect:"off",autocapitalize:"off"},domProps:{value:t.username},on:{input:function(e){e.target.composing||(t.username=e.target.value)}}})]),r("fieldset",[t._m(1),r("input",{directives:[{name:"model",rawName:"v-model",value:t.password,expression:"password"}],staticClass:"text-input",attrs:{type:"password",name:"password"},domProps:{value:t.password},on:{input:function(e){e.target.composing||(t.password=e.target.value)}}}),t.error.username?r("span",{staticClass:"error"},[t._v(t._s(t.error.username))]):t._e()]),r("fieldset",[r("label",[t._v("验证码"),r("span",{domProps:{innerHTML:t._s(t.svg)},on:{click:t.refreshCaptcha}})]),r("input",{directives:[{name:"model",rawName:"v-model",value:t.captcha,expression:"captcha"}],staticClass:"text-input",attrs:{type:"text"},domProps:{value:t.captcha},on:{input:function(e){e.target.composing||(t.captcha=e.target.value)}}}),t.error.captcha?r("span",{staticClass:"error"},[t._v(t._s(t.error.captcha))]):t._e()])]),r("input",{staticClass:"button form-sub",attrs:{type:"submit",value:"登录",tabindex:"3"}})])])])])])])},s=[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("nav",{staticClass:"auth-nav"},[r("p",{staticClass:"auth-home"},[t._v(" 回到 "),r("a",{attrs:{href:"/"}},[t._v("首页")])]),r("p",{staticClass:"auth-link"},[t._v(" 没有账号? "),r("a",{attrs:{href:"/register"}},[t._v("马上注册")])])])},function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("label",{staticClass:"password"},[t._v("密码 "),r("a",{attrs:{href:"/password_resets/new"}},[t._v("忘记密码?")])])}],o={name:"Login",components:{},mixins:[],data(){return{error:{captcha:"",username:""},captcha:"",svg:"",username:"",password:"",isLoading:!1,workViewPort:{width:200,height:200}}},computed:{workBackground(){return this.showWork?this.showWork.color:""},showWork(){return this.works.length?this.works[0]:null}},created(){},mounted(){this.refreshCaptcha()},methods:{async refreshCaptcha(){const t=await this.ctx.userdao.getCaptcha();this.svg=t.svg},register(){this.$router.push("/register")},async login(){this.isLoading=!0;let t=await this.ctx.userdao.login(this.username,this.password,this.captcha);return"100400"===t.code&&(this.error.captcha="验证码不正确",this.refreshCaptcha(),this.isLoading=!1),401===t.code&&(this.error.captcha="",this.error.username=t.message,this.captcha="",this.refreshCaptcha(),this.isLoading=!1),200===t.code&&(this.ctx.user=t.user,this.ctx.toPath?(this.$router.replace(this.ctx.toPath),this.ctx.toPath=null):this.$router.replace("/"),this.isLoading=!1),!1}}},i=o,n=(r("176d"),r("2877")),c=Object(n["a"])(i,a,s,!1,null,null,null);e["default"]=c.exports},d84e:function(t,e,r){},f0d9:function(t,e,r){"use strict";e.__esModule=!0,e.default={el:{colorpicker:{confirm:"确定",clear:"清空"},datepicker:{now:"此刻",today:"今天",cancel:"取消",clear:"清空",confirm:"确定",selectDate:"选择日期",selectTime:"选择时间",startDate:"开始日期",startTime:"开始时间",endDate:"结束日期",endTime:"结束时间",prevYear:"前一年",nextYear:"后一年",prevMonth:"上个月",nextMonth:"下个月",year:"年",month1:"1 月",month2:"2 月",month3:"3 月",month4:"4 月",month5:"5 月",month6:"6 月",month7:"7 月",month8:"8 月",month9:"9 月",month10:"10 月",month11:"11 月",month12:"12 月",weeks:{sun:"日",mon:"一",tue:"二",wed:"三",thu:"四",fri:"五",sat:"六"},months:{jan:"一月",feb:"二月",mar:"三月",apr:"四月",may:"五月",jun:"六月",jul:"七月",aug:"八月",sep:"九月",oct:"十月",nov:"十一月",dec:"十二月"}},select:{loading:"加载中",noMatch:"无匹配数据",noData:"无数据",placeholder:"请选择"},cascader:{noMatch:"无匹配数据",loading:"加载中",placeholder:"请选择",noData:"暂无数据"},pagination:{goto:"前往",pagesize:"条/页",total:"共 {total} 条",pageClassifier:"页"},messagebox:{title:"提示",confirm:"确定",cancel:"取消",error:"输入的数据不合法!"},upload:{deleteTip:"按 delete 键可删除",delete:"删除",preview:"查看图片",continue:"继续上传"},table:{emptyText:"暂无数据",confirmFilter:"筛选",resetFilter:"重置",clearFilter:"全部",sumText:"合计"},tree:{emptyText:"暂无数据"},transfer:{noMatch:"无匹配数据",noData:"无数据",titles:["列表 1","列表 2"],filterPlaceholder:"请输入搜索内容",noCheckedFormat:"共 {total} 项",hasCheckedFormat:"已选 {checked}/{total} 项"},image:{error:"加载失败"},pageHeader:{title:"返回"},popconfirm:{confirmButtonText:"确定",cancelButtonText:"取消"}}}},ffae:function(t,e,r){"use strict";var a=r("3ba4"),s=r.n(a);s.a}}]);